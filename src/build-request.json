{
  "kind": "build_request",
  "title": "Implement immediate bounty collection on task publication",
  "projectName": "Grit Bounty",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "When user clicks the publish button after filling task information (title, description, reward amount, difficulty, participant count), show a confirmation dialog displaying all task details before final submission",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-last"
        ]
      },
      "acceptanceCriteria": [
        "Confirmation dialog appears after clicking publish button",
        "Dialog displays quest title, description, reward pool amount, difficulty, and participant count",
        "Dialog has a confirm button to proceed with publication",
        "Dialog has a cancel button to return to the form"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Upon confirming task publication in the dialog, immediately deduct the full bounty amount from the publisher's ICP balance and lock it in the task contract",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-last"
        ]
      },
      "acceptanceCriteria": [
        "Bounty amount is deducted from publisher balance immediately upon confirmation",
        "Funds are locked in the quest contract and not in publisher available balance",
        "Quest creation only succeeds if funds are successfully locked",
        "Transaction is atomic - either both deduction and quest creation succeed, or both fail"
      ]
    },
    {
      "id": "REQ-3",
      "text": "If the publisher account balance is insufficient to cover the bounty amount, display an error message and prevent task publication",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-last"
        ]
      },
      "acceptanceCriteria": [
        "Backend validates sufficient balance before creating quest",
        "Frontend displays clear error message when balance is insufficient",
        "Error message shows required amount and current balance",
        "User remains on the form to adjust bounty amount or cancel",
        "No quest is created when balance check fails"
      ]
    },
    {
      "id": "REQ-4",
      "text": "Allow publishers to cancel a task and receive a full refund of the locked bounty amount when no warrior has accepted the task yet, without charging any cancellation fee",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-last"
        ]
      },
      "acceptanceCriteria": [
        "Cancel button is available on publisher posted quests when acceptedBy array is empty",
        "Clicking cancel returns the full locked bounty amount to publisher balance",
        "No fees are deducted from the refund",
        "Quest is removed from active quests list after cancellation",
        "Cancel button is hidden or disabled once a warrior has accepted the quest"
      ]
    }
  ],
  "constraints": [
    "Do not modify any existing functionality beyond task publication and cancellation flow",
    "Do not change the LaunchMission form fields or validation logic except for balance checking",
    "Do not alter the quest acceptance mechanism for warriors",
    "Do not modify the check-in, completion, or dispute resolution features",
    "Do not change the credit score system or user profile functionality"
  ],
  "nonGoals": [
    "Modifying warrior deposit collection timing",
    "Changing platform fee structure or collection points",
    "Altering the crowdfunding contribution mechanism",
    "Implementing partial refunds or cancellation fees",
    "Adding cancellation functionality after warrior acceptance"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}